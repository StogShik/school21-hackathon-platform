<%- include('../partials/header.ejs', { title: 'Команда', user: user }) %>

<div class="container mt-4">
  <h1>Команда: <%= team.name %></h1>
  
  <!-- Форма редактирования GitHub-ссылки. Отображается только для участников команды -->
  <% 
    const memberIds = team.members.map(member => member._id.toString());
    if (memberIds.includes(user._id.toString())) { 
  %>
 
    <form id="edit-github-form" action="/team/<%= team._id %>/edit-github" method="POST">
      <div class="form-group">
        <label for="githubLink">GitHub-ссылка:</label>
        <input type="url" class="form-control" id="githubLink" name="githubLink" placeholder="Введите ссылку" value="<%= team.githubLink ? team.githubLink : '' %>">
      </div>
      <button type="submit" id="saveGithubButton" class="btn btn-primary" disabled>Сохранить</button>
    </form>
    
    <script>
      // После загрузки документа устанавливаем обработчик изменения значения
      document.addEventListener("DOMContentLoaded", function() {
          var githubInput = document.getElementById("githubLink");
          var saveButton = document.getElementById("saveGithubButton");
          // Запоминаем исходное значение из поля
          var initialValue = githubInput.value.trim();
          
          // Обработчик события input
          githubInput.addEventListener("input", function() {
              var currentValue = githubInput.value.trim();
              // Если значение отличается от исходного, разрешаем отправку формы
              if (currentValue !== initialValue) {
                  saveButton.disabled = false;
              } else {
                  saveButton.disabled = true;
              }
          });
      });
    </script>
    <% } %>
  <br>  
  <h3>Участники:</h3>
  <ul class="list-group">
    <% team.members.forEach(member => { %>
      <li class="list-group-item"><%= member.username %></li>
    <% }); %>
  </ul>
  
  <!-- Кнопка для приглашения участника -->
  <div class="mt-3">
    <a href="/team/<%= team._id %>/invite" class="btn btn-primary">Пригласить участника</a>
  </div>
  
  <!-- Кнопка для выхода из команды -->
  <div class="mt-3">
    <form action="/team/<%= team._id %>/leave" method="POST" onsubmit="return confirm('Вы уверены, что хотите покинуть команду?');">
      <button type="submit" class="btn btn-warning">Покинуть команду</button>
    </form>
  </div>
  
</div>

<%- include('../partials/footer.ejs') %>
